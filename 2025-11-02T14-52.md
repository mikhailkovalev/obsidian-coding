#habr #networking
[Source](https://habr.com/ru/articles/925448/)
**Link** (линк) - просто соединение между двумя хостами. Чаще всего -- обычный провод: витая пара или оптоволокно.

**Ethernet** -- технология, позволяющая хостам соединяться в локальную сеть (LAN) и обмениваться данными с помощью проводов (витая пара или оптоволокно).

**LAN** (Local Area Network) - сеть, объединяющая устройства, расположенные на территории в масштабах от одной комнаты до города. Обычно LAN принадлежит одному физическому или юридическому лицу

**Сетевой адаптер** = **Сетевой интерфейс** = **Сетевая карта** -- разъём в компьютере, куда втыкать кабель от интернета. Контролируется операционной системой.

**Топология сети** - схема соединения устройств в сети. Т.е. то, как компьютеры соединены проводами.

**Коммутатор** = **Switch** -- получает сигнал от одного хоста и посылает сигнал другому, которму этот сигнал предназначен.

Коммутатор - устройство **канального уровня**

**MAC-адрес** - физический адрес устройства -  уникальный идентификатор сетевого устройства, задаётся производителем, но может быть изменён вручную.
> Злоумышленник может подменить MAC-адрес на своём устройстве внутри сети и получить сообщение, предназначенное другому устройству

**Таблица коммутации** - "память" коммутатора, где он хранит список соответствия MAC-адресов устройств и портов, к которым они подключены.

**Кадр** -- сообщение канального уровня, которое содержит MAC-адрес отправителя и MAC-адрес получателя.

Изначально таблица пуста. При выполнении запроса через коммутатор, то он
 - читает из кадра мак-адрес получателя
 - сопоставляет его с портом, по которому пришёл запрос
 - опрашивает все связанные с ним устройства (через broadcast (широковещательный) запрос по специальному MAC-адресу `FF:FF:FF:FF:FF:FF`)
 - в ответах получает MAC-адреса этих устройств
 - заполняет таблицу коммутации сопоставляя MAC-адреса с портами, по которым они пришли

**IP** (Internet Protocol) - протокол **сетевого уровня**
**Пакет** -- сообщение, пересылаемое на **сетевом уровне**
**IP-адрес** -- логический адрес устройства

**Структура IPv4**
IP состоит из 4 частей -- октетов. Каждый октет -- это 8 бит.
Пример: `172.16.128.17` = `10101100.00010000.10000000.00010001`
Так же делится на **адрес подсети** (одинаков для всех устройств в одной сети) и **адрес хоста** (уникален для всех устройств в одной сети)
Примеры зарезервированных адресов:
`0.0.0.0`- "любой адрес". Например, можно прописать в настройках сервера -- чтобы сервер был готов получать запросы с любого устройства
`255.255.255.255` - "каждый адрес" - для широковещательных запросов всем устройствам внутри сети
`10.0.0.0/8`, `192.168.0.0/16`, `172.16.0.0/12` - доступны только внутри локальных сетей
**Маска подсети** - обозначения `/8`, `/16`,  `/12` - указывает сколько бит относится к **адресу подсети**
Пример 1: `172.16.37.5/16`
 -  адрес подсети: `172.16.0.0/16
 -  адрес хоста: `0.0.37.5`
Пример 2: `172.16.37.5/12`
 - адрес подсети: `10101100.0001[0000.00000000.00000000]` = `172.16.0.0/12`
 - адрес хоста: `0000.00100101.00000101` - адрес хоста
 - широковещательный адрес для сети: `172.31.255.255/12`

При отправке запроса по IP наш хост знает в какой сети он находится.
- если IP хоста, которому предназначен запрос в этой же сети -- запрос отсылается напрямую
- иначе нужно передать запрос в ту подсеть, в которой находится хост-адресат через **маршрутизатор**

**Маршрутизатор** = **Роутер** - устройство **сетевого уровня**, пересылающее данные между разными сетями, выбирая оптимальный путь для их доставки.

У маршрутизатора несколько сетевых интерфейсов (разъёмов для провода), каждый из которых имеет адрес подсети, к которой он подключен

**Шлюз подсети** - сетевой интерфейс маршрутизатора, находящийся в текущей подсети.

При формировании кадра для другой подсети мы НЕ знаем MAC-адрес получателя -- поэтому указываем MAC-адрес шлюза подсети. При переходе кадра в другую подсеть -- наоборот -- MAC-адрес отправителя подменяется на MAC-адрес шлюза этой подсети.

**DHCP сервер** - устройство "раздающее" IP-адреса. Знает диапазон адресов подсети, принимает решение какой IP-адрес получит каждое устройство и на какое время.

Модель **TCP/IP** на примере
**4\. Прикладной уровень**
Хотим через браузер отправить картинку
**3\. Транспортный уровень**
Происходит сегментация данных (разбиение исходных данных на куски около 1.5КБ - **сегменты**), для каждого сегмента указываем инструкцию по распаковке и обратной сборке.
**2\. Сетевой уровень**
Данные логически передаются между устройствами по IP
Сегменты кладём в **пакеты**, в пакетах указываем IP адреса получателя и отправителя.
**1\. Канальный уровень**
Отвечает за физическую адресацию -- пакеты кладём в кадры, на кадре пишем MAC-адреса отправителя и получателя.

Протоколы транспортного уровня: TCP и UDP
 - разбивают данные на сегменты
 - контролируют порядок передачи сегментов

**Порт** - число от 0 до 65535, по которому сегменты сопоставляются с программами, которые их должны обработать
**Сокет** - программный интерфейс - привязывает соединение по IP к определённому порту. Т.е. Сокет = IP:ПОРТ

Каждое открытое соединение имеет два сокета
 - на стороне клиента (кто открыл соединение) IP-клиента:порт-в-системе-клиента
 - на стороне сервера (кто принял соединение) IP-сервера:порт-в-системе-сервера

У каждой подсети есть публичный IP-адрес (**WAN-адрес** роутера)

Технология NAT (Network Address Translation) - преобразование частного IP в публичный и наоборот.