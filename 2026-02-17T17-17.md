#postgres #logging #log #docker
# Включить логирование запросов в контейнере

Зайти в контейнер, там в `psql` найти
```sql
SHOW config_file;  -- путь к файлу конфига
SHOW data_directory;  -- путь к папке с данными
SHOW log_directory; -- путь к папке с логами относительно data_directory
SHOW log_filename;  -- шаблон файла лога
```

В файле конфига прописать
```
logging_collector = on
log_statement = 'all'
```

У меня в контейнере не оказалось nano и vim, поэтому сделал по-хардкору:
```bash
cat -n /path/to/postgres.conf | grep logging_collector
# 436 # requires logging_collector to be on.
# 439 #logging_collector = off # Enable capturing of stderr and csvlog
# 444 # These are only used if logging_collector is on:

# Видим, что параметр задаётся в строке 439, заменим её на строку а-ля
# 'logging_collector = on'
sed -i '439s/.*/logging_collector = on/' /path/to/postgres.conf
```

Для `log_statement` был подводный камень с экранированием одинарных кавычек:
```bash
sed -i $'575s/.*/log_statement = \'all\'/' /path/to/postgres.conf
```

Перезапустить докер-контейнер (значение `logging_collector`  без этого не поменяется)
```bash
docker restart my-postgres-container
```

Проверить, что всё применилось можно в `psql`:
```sql
SHOW logging_collector;
SHOW log_statement;
```

Если изменения применились -- можете запускать локально тесты, находить файл с логами используя значения из `data_directory`, `log_directory`, `log_filename` и далее искать в нём свой запрос
